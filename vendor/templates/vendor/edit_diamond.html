{% extends 'base.html' %}

{% block title %}Edit Diamond{% endblock %}

{% block content %}

<h2 class="mb-4">Diamond Details</h2>

<hr class="my-4">
<h4>Edit Details</h4>

<form method="post" id="edit-diamond-form">
    {% csrf_token %}
    
    <!-- JSON file upload -->
    <div class="mb-3">
        <label for="json-upload" class="form-label">Import JSON to Auto-Fill Form</label>
        <input type="file" id="json-upload" class="form-control" accept=".json">
    </div>

    <!-- Form fields in two columns -->
    <div class="row">
        <!-- Column 1 -->
        <div class="col-md-6">
            <div class="mb-3">
                <label for="{{ form.types.id_for_label }}" class="form-label">{{ form.types.label }}</label>
                {{ form.types }}
                {% if form.types.errors %}
                    <div class="text-danger">{{ form.types.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.stock_id.id_for_label }}" class="form-label">{{ form.stock_id.label }}</label>
                {{ form.stock_id }}
                {% if form.stock_id.errors %}
                    <div class="text-danger">{{ form.stock_id.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.report_number.id_for_label }}" class="form-label">{{ form.report_number.label }}</label>
                {{ form.report_number }}
                {% if form.report_number.errors %}
                    <div class="text-danger">{{ form.report_number.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.lab.id_for_label }}" class="form-label">{{ form.lab.label }}</label>
                {{ form.lab }}
                {% if form.lab.errors %}
                    <div class="text-danger">{{ form.lab.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.shape.id_for_label }}" class="form-label">{{ form.shape.label }}</label>
                {{ form.shape }}
                {% if form.shape.errors %}
                    <div class="text-danger">{{ form.shape.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.carat.id_for_label }}" class="form-label">{{ form.carat.label }}</label>
                {{ form.carat }}
                {% if form.carat.errors %}
                    <div class="text-danger">{{ form.carat.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.color.id_for_label }}" class="form-label">{{ form.color.label }}</label>
                {{ form.color }}
                {% if form.color.errors %}
                    <div class="text-danger">{{ form.color.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.clarity.id_for_label }}" class="form-label">{{ form.clarity.label }}</label>
                {{ form.clarity }}
                {% if form.clarity.errors %}
                    <div class="text-danger">{{ form.clarity.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.rap_rate.id_for_label }}" class="form-label">{{ form.rap_rate.label }}</label>
                {{ form.rap_rate }}
                {% if form.rap_rate.errors %}
                    <div class="text-danger">{{ form.rap_rate.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.discount_percentage.id_for_label }}" class="form-label">{{ form.discount_percentage.label }}</label>
                {{ form.discount_percentage }}
                {% if form.discount_percentage.errors %}
                    <div class="text-danger">{{ form.discount_percentage.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.cut.id_for_label }}" class="form-label">{{ form.cut.label }}</label>
                {{ form.cut }}
                {% if form.cut.errors %}
                    <div class="text-danger">{{ form.cut.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.polish.id_for_label }}" class="form-label">{{ form.polish.label }}</label>
                {{ form.polish }}
                {% if form.polish.errors %}
                    <div class="text-danger">{{ form.polish.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.symmetry.id_for_label }}" class="form-label">{{ form.symmetry.label }}</label>
                {{ form.symmetry }}
                {% if form.symmetry.errors %}
                    <div class="text-danger">{{ form.symmetry.errors }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.fluorescence.id_for_label }}" class="form-label">{{ form.fluorescence.label }}</label>
                {{ form.fluorescence }}
                {% if form.fluorescence.errors %}
                    <div class="text-danger">{{ form.fluorescence.errors }}</div>
                {% endif %}
            </div>
        </div>

        <!-- Column 2 -->
        <div class="col-md-6">

            <div class="mb-3">
                <label for="{{ form.length.id_for_label }}" class="form-label">{{ form.length.label }}</label>
                {{ form.length }}
                {% if form.length.errors %}
                    <div class="text-danger">{{ form.length.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.width.id_for_label }}" class="form-label">{{ form.width.label }}</label>
                {{ form.width }}
                {% if form.width.errors %}
                    <div class="text-danger">{{ form.width.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.height.id_for_label }}" class="form-label">{{ form.height.label }}</label>
                {{ form.height }}
                {% if form.height.errors %}
                    <div class="text-danger">{{ form.height.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.table_percentage.id_for_label }}" class="form-label">{{ form.table_percentage.label }}</label>
                {{ form.table_percentage }}
                {% if form.table_percentage.errors %}
                    <div class="text-danger">{{ form.table_percentage.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.depth_percentage.id_for_label }}" class="form-label">{{ form.depth_percentage.label }}</label>
                {{ form.depth_percentage }}
                {% if form.depth_percentage.errors %}
                    <div class="text-danger">{{ form.depth_percentage.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.crown_angle.id_for_label }}" class="form-label">{{ form.crown_angle.label }}</label>
                {{ form.crown_angle }}
                {% if form.crown_angle.errors %}
                    <div class="text-danger">{{ form.crown_angle.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.crown_height_percentage.id_for_label }}" class="form-label">{{ form.crown_height_percentage.label }}</label>
                {{ form.crown_height_percentage }}
                {% if form.crown_height_percentage.errors %}
                    <div class="text-danger">{{ form.crown_height_percentage.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.pavilion_angle.id_for_label }}" class="form-label">{{ form.pavilion_angle.label }}</label>
                {{ form.pavilion_angle }}
                {% if form.pavilion_angle.errors %}
                    <div class="text-danger">{{ form.pavilion_angle.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.pavilion_depth.id_for_label }}" class="form-label">{{ form.pavilion_depth.label }}</label>
                {{ form.pavilion_depth }}
                {% if form.pavilion_depth.errors %}
                    <div class="text-danger">{{ form.pavilion_depth.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.ratio.id_for_label }}" class="form-label">{{ form.ratio.label }}</label>
                {{ form.ratio }}
                {% if form.ratio.errors %}
                    <div class="text-danger">{{ form.ratio.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.bgm.id_for_label }}" class="form-label">{{ form.bgm.label }}</label>
                {{ form.bgm }}
                {% if form.bgm.errors %}
                    <div class="text-danger">{{ form.bgm.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.video_360.id_for_label }}" class="form-label">{{ form.video_360.label }}</label>
                {{ form.video_360 }}
                {% if form.video_360.errors %}
                    <div class="text-danger">{{ form.video_360.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.photo.id_for_label }}" class="form-label">{{ form.photo.label }}</label>
                {{ form.photo }}
                {% if form.photo.errors %}
                    <div class="text-danger">{{ form.photo.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.pdf.id_for_label }}" class="form-label">{{ form.pdf.label }}</label>
                {{ form.pdf }}
                {% if form.pdf.errors %}
                    <div class="text-danger">{{ form.pdf.errors }}</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <button type="button" class="btn btn-danger" onclick="window.location.href='{% url 'vendor:load_diamonds' %}'">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
    </div>
</form>

<script>
    document.getElementById('json-upload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const data = JSON.parse(event.target.result);
                const diamond = Array.isArray(data) ? data[0] : data;
                for (const key in diamond) {
                    const field = document.querySelector(`[name="${key}"]`);
                    if (field) {
                        field.value = diamond[key];
                    }
                }
            } catch (err) {
                alert('Invalid JSON format.');
            }
        };
        reader.readAsText(file);
    });
</script>

{% endblock %}
