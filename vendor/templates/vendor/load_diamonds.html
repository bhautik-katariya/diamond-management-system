{% extends 'base.html' %}
{% block title %}Your Diamonds{% endblock %}

{% block content %}
<h2 class="mb-4">Your Diamonds</h2>

<style>
    table.table thead.table-dark th {
        background-color: #e6f4fa !important;
        color:  rgb(11, 25, 55) !important;               
        text-align: center;
        vertical-align: middle;
        white-space: normal !important;
        word-wrap: break-word;
        font-size: 0.9rem;
    }

    .table-container {
        overflow-x: auto;
    }

    .table th, .table td {
        white-space: nowrap;
        text-align: center;
        vertical-align: middle;
        font-size: 0.9rem;
    }

    @media (max-width: 768px) {
        .table th, .table td {
            font-size: 0.75rem;
            padding: 6px;
        }
    }
</style>

{% if diamonds %}
<div class="table-container table-responsive">
    <table class="table table-striped table-bordered table-hover w-100">
        <thead class="table-dark">
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th>Sr No</th>
                <th>Stock Id</th>
                <th>Report #</th>
                <th>Type</th>
                <th>Lab</th>
                <th>Shape</th>
                <th>Carat</th>
                <th>Color</th>
                <th>Clarity</th>
                <th>Cut</th>
                <th>Polish</th>
                <th>Symmetry</th>
                <th>Fluorescence</th>
                <th>Price/Carat</th>
                <th>Video</th>
                <th>Photo</th>
                <th>Report</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for diamond in diamonds %}
            <tr>
                <td><input type="checkbox" class="row-checkbox" name="selected_diamonds" value="{{ diamond.id }}"></td>
                <td>{{ forloop.counter }}</td>
                <td>{{ diamond.stock_id }}</td>
                <td>{{ diamond.report_number }}</td>
                <td>{{ diamond.type }}</td>
                <td>{{ diamond.lab }}</td>
                <td>{{ diamond.get_shape_display }}</td>
                <td>{{ diamond.carat }}</td>
                <td>{{ diamond.get_color_display }}</td>
                <td>{{ diamond.get_clarity_display }}</td>
                <td>{{ diamond.get_cut_display }}</td>
                <td>{{ diamond.get_polish_display }}</td>
                <td>{{ diamond.get_symmetry_display }}</td>
                <td>{{ diamond.fluorescence }}</td>
                <td>{{ diamond.price_per_carat }}</td>
                <td>
                    {% if diamond.video_360 %}
                        <a href="{{ diamond.video_360 }}" target="_blank">Video</a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if diamond.photo %}
                        <a href="{{ diamond.photo }}" target="_blank">Image</a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if diamond.pdf %}
                        <a href="{{ diamond.pdf }}" target="_blank">PDF</a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'vendor:edit_diamond' diamond.id %}" class="btn btn-secondary btn-sm">Edit</a>
                </td> 
                <td>
                    <button class="btn btn-sm btn-danger" onclick="showConfirm(this)" data-url="{% url 'vendor:delete_diamond' diamond.id %}">
                        Delete
                    </button>
                    <span class="d-none ms-2" data-confirm-box>
                        <span class="text-danger fw-bold">Confirm?</span>
                        <a href="#" class="btn btn-sm btn-outline-danger" onclick="confirmDelete(this)">Yes</a>
                        <button class="btn btn-sm btn-outline-secondary" onclick="cancelDelete(this)">Cancel</button>
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-muted">You have not added any diamonds yet.</p>
{% endif %}

{% if page_obj %}
<nav aria-label="Pagination" class="mt-3 d-flex justify-content-center">
  <ul class="pagination" style="gap:10px;">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" style="border-radius:24px;background:#0a1835;color:#fff;padding:10px 18px;box-shadow:0 4px 12px rgba(10,24,53,.25);" href="?page=1">&laquo; First</a></li>
      <li class="page-item"><a class="page-link" style="border-radius:24px;background:#0a1835;color:#fff;padding:10px 18px;box-shadow:0 4px 12px rgba(10,24,53,.25);" href="?page={{ page_obj.previous_page_number }}">‹ Prev</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link" style="border-radius:24px;background:#eef1f5;color:#9aa4b2;padding:10px 18px;">‹ Prev</span></li>
    {% endif %}

    <li class="page-item active"><span class="page-link" style="border-radius:24px;background:#0a1835;color:#fff;padding:10px 18px;">{{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" style="border-radius:24px;background:#0a1835;color:#fff;padding:10px 18px;box-shadow:0 4px 12px rgba(10,24,53,.25);" href="?page={{ page_obj.next_page_number }}">Next ›</a></li>
      <li class="page-item"><a class="page-link" style="border-radius:24px;background:#0a1835;color:#fff;padding:10px 18px;box-shadow:0 4px 12px rgba(10,24,53,.25);" href="?page={{ page_obj.paginator.num_pages }}">Last »</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link" style="border-radius:24px;background:#eef1f5;color:#9aa4b2;padding:10px 18px;">Next ›</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}

<script>
    // Select all logic
    (function() {
        const selectAll = document.getElementById('select-all');
        if (!selectAll) return;
        const rowChecks = document.querySelectorAll('.row-checkbox');
        selectAll.addEventListener('change', function() {
            rowChecks.forEach(cb => cb.checked = selectAll.checked);
            selectAll.indeterminate = false;
        });
        rowChecks.forEach(cb => {
            cb.addEventListener('change', function() {
                const total = rowChecks.length;
                const checked = Array.from(rowChecks).filter(x => x.checked).length;
                selectAll.checked = checked === total;
                selectAll.indeterminate = checked > 0 && checked < total;
            });
        });
    })();

    function showConfirm(button) {
        const confirmBox = button.nextElementSibling;
        confirmBox.classList.remove('d-none');
        button.style.display = 'none';
    }

    function cancelDelete(button) {
        const confirmBox = button.parentElement;
        const deleteBtn = confirmBox.previousElementSibling;
        confirmBox.classList.add('d-none');
        deleteBtn.style.display = 'inline-block';
    }

    function confirmDelete(button) {
        const confirmBox = button.parentElement;
        const deleteUrl = confirmBox.previousElementSibling.getAttribute('data-url');
        window.location.href = deleteUrl;
    }
</script>
{% endblock %}
